=============================================================================
QUICK DEPLOYMENT - StreamingCandle (All Issues Fixed)
=============================================================================

ON YOUR LOCAL MACHINE:
----------------------
cd /Users/shivendrapratap/Documents/kotsin/streamingcandle
scp target/demo-0.0.1-SNAPSHOT.jar ubuntu@13.203.60.173:/home/ubuntu/streamingcandle/demo.jar
scp scripts/*.sh ubuntu@13.203.60.173:/home/ubuntu/streamingcandle/scripts/

ON SERVER:
----------
ssh ubuntu@13.203.60.173
cd /home/ubuntu/streamingcandle

# 1. Stop old version
pkill -f demo.jar

# 2. Clean state stores
./scripts/cleanup-state-stores.sh

# 3. Delete wrong changelog topics (if they exist)
chmod +x scripts/*.sh
bash scripts/delete-wrong-topics.sh 13.203.60.173:9094 /opt/kafka/bin

# 4. Create ALL data topics (candles + family)
bash scripts/create-changelog-topics.sh 13.203.60.173:9094 /opt/kafka/bin

# 5. Start application
export SPRING_PROFILES_ACTIVE=production
nohup java -jar demo.jar > logs/app.log 2>&1 &
echo $! > app.pid

# 5. Monitor
tail -f logs/app.log | grep -E "(âœ…|âŒ|ğŸ“¤)"

VERIFY SUCCESS:
---------------
# All consumer groups stable
kafka-consumer-groups.sh --bootstrap-server 13.203.60.173:9094 --list

# Data in candles
kafka-console-consumer.sh --bootstrap-server 13.203.60.173:9094 \
  --topic candle-complete-1m --max-messages 5

# Health check
curl http://localhost:8081/api/v1/health

EXPECTED TOPICS (15 total):
---------------------------
Candles: candle-complete-{1m,2m,3m,5m,15m,30m}
Family:  family-structured-{1m,2m,5m,15m,30m,all}
Changelogs: instrument-*-changelog (3 topics)

SUCCESS LOGS:
-------------
âœ… Started per-instrument candle stream
âœ… State has complete windows
ğŸ“¤ candle emit tf=1m scrip=XXX vol=XXX â†’ candle-complete-1m
âœ… Family streams started successfully

FIXES APPLIED:
--------------
âœ… Issue #1: Topic dependencies (startup delay + retry)
âœ… Issue #2: State store corruption (standby replicas)
âœ… Issue #3: Out-of-order data (30s grace period)
âœ… Issue #6: Serialization (@JsonIgnore)
âœ… Issue #7b: VPIN formula (corrected normalization)
âœ… Issue #8: ArrayList performance (ArrayDeque)
âœ… Issue #9: Monitoring (health endpoints)
âœ… Issue #10: Config validation (startup checks)
âœ… Issue #13: Logging (INFO level)

READY TO DEPLOY: YES âœ…
=============================================================================

