# DEFAULT PROFILE = PRODUCTION
# Default to replay profile unless overridden
spring.profiles.default=production

spring.application.name=streamingcandle
server.port=8081



# ============================================================================
# KAFKA STREAMS CONFIGURATION
# ============================================================================
spring.kafka.bootstrap-servers=localhost:9092
spring.kafka.streams.application-id=unified-market-processor
spring.kafka.streams.client-id=streamingcandle
spring.kafka.streams.state-dir=/tmp/kafka-streams/${spring.application.name}

# Serdes
spring.kafka.streams.properties.default.key.serde=org.apache.kafka.common.serialization.Serdes$StringSerde
spring.kafka.streams.properties.default.value.serde=org.springframework.kafka.support.serializer.JsonSerde
spring.kafka.streams.properties.spring.json.trusted.packages=com.kotsin.consumer.model

# Offset reset - consume from latest
spring.kafka.streams.properties.auto.offset.reset=earliest

# Processing guarantee (at_least_once or exactly_once_v2)
spring.kafka.streams.properties.processing.guarantee=at_least_once
spring.kafka.streams.properties.replication.factor=1

# Performance tuning
spring.kafka.streams.properties.commit.interval.ms=100
spring.kafka.streams.properties.statestore.cache.max.bytes=104857600
spring.kafka.streams.properties.num.stream.threads=3
spring.kafka.streams.properties.session.timeout.ms=30000
spring.kafka.streams.properties.heartbeat.interval.ms=3000
spring.kafka.streams.properties.request.timeout.ms=40000
spring.kafka.streams.properties.retry.backoff.ms=100
spring.kafka.streams.properties.reconnect.backoff.ms=50
spring.kafka.streams.properties.linger.ms=5
spring.kafka.streams.properties.batch.size=1024
spring.kafka.streams.properties.buffer.memory=33554432

# Topology optimization
spring.kafka.streams.properties.topology.optimization=all

# Deserialization exception handler
spring.kafka.streams.properties.default.deserialization.exception.handler=org.apache.kafka.streams.errors.LogAndContinueExceptionHandler

# Producer timestamp type
spring.kafka.streams.properties.producer.message.timestamp.type=CreateTime

# Redis removed: in-memory cache only

# ============================================================================
# UNIFIED MARKET DATA PROCESSOR CONFIGURATION
# ============================================================================
# Input topics
unified.input.topic.ticks=forwardtesting-data
unified.input.topic.oi=OpenInterest
unified.input.topic.orderbook=Orderbook

# âœ… P2-2 FIX: Windowing configuration (externalized from hardcoded values)
# Grace period: how long to wait for late-arriving data after window closes
# Trade-off: Higher grace = more complete data but higher latency
# 30 seconds captures 95%+ of late data without excessive delay
unified.streams.window.grace.period.seconds=30

# Finalized candle topics
stream.outputs.candles.enabled=true
stream.outputs.candles.1m=candle-complete-1m
stream.outputs.candles.2m=candle-complete-2m
stream.outputs.candles.3m=candle-complete-3m
stream.outputs.candles.5m=candle-complete-5m
stream.outputs.candles.15m=candle-complete-15m
stream.outputs.candles.30m=candle-complete-30m-v2

# Family aggregation disabled; per-instrument streams only
stream.outputs.familyStructured.enabled=false

# ============================================================================
# LOGGING CONFIGURATION (Issue #13 Fix)
# ============================================================================
# Root log level
logging.level.root=INFO

# Application logs
logging.level.com.kotsin.consumer=INFO

# Kafka Streams (reduce noise)
logging.level.org.apache.kafka.streams=WARN
logging.level.org.springframework.kafka=WARN

trading.hours.validation.enabled=false
# DEBUG only for specific troubleshooting (comment out in production)
# logging.level.com.kotsin.consumer.service.CandleEmissionService=DEBUG
# logging.level.com.kotsin.consumer.service.InstrumentStateManager=DEBUG
